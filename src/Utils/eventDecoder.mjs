import { ethers } from "ethers";

// uses abicoder to decode logs data parsed into it
export function dataExpander(params) {
  console.log(params);
  const res = ethers.utils.defaultAbiCoder.decode(
    params.dataVarTypes,
    params.data
  );
  console.log(res);

  return res;
}

// takes in indexed log hex data and unindexed log data with its varaible type and decodes it
export async function eventVar(params) {
  const event = params.events;

  // use split to get the var types of the event var type parsed in params
  const step1 = event.split("(");
  const step2 = step1[1].split(")");
  const step3 = step2[0].split(",");

  console.log(step3);

  let logsArr = [];

  // loops through the indexed event and the expanded event var type and AbiDecodes it
  for (let i = 1; i < params.logs.length; i++) {
    logsArr.push(
      ...dataExpander({
        dataVarTypes: [step3[i - 1]],
        data: params.logs[i],
      })
    );
  }

  console.log(logsArr);

  const dataVars = step3.splice(params.logs.length - 1);
  console.log(dataVars);

  let dataArr = [];

  dataArr.push(
    await eventDecoder({
      data: params.data,
      textSignature: `(${dataVars.join("")})`,
    })
  );

  console.log(dataArr);

  return {
    indexed: logsArr,
    unindexed: dataArr,
  };
}

export async function inputDataDecoder(params) {
  const ABI = [`function ${params.textSignature} public`];

  const interfaces = new ethers.utils.Interface(ABI);
  console.log(interfaces);

  const decoded = interfaces.decodeFunctionData(
    params.textSignature,
    params.data
  );
  console.log(decoded);

  return decoded;
}

export async function eventDecoder(params) {
  console.log(1, params);
  const ABI = [`event ${params.textSignature}`];

  const interfaces = new ethers.utils.Interface(ABI);
  console.log(interfaces);

  const decoded = interfaces.decodeEventLog(
    params.textSignature,
    params.data,
    params.logs
  );
  console.log(decoded);

  return decoded;
}

// inputDataDecoder({
//   textSignature:
//     "fulfillAdvancedOrder(((address,address,(uint8,address,uint256,uint256,uint256)[],(uint8,address,uint256,uint256,uint256,address)[],uint8,uint256,uint256,bytes32,uint256,bytes32,uint256),uint120,uint120,bytes,bytes),(uint256,uint8,uint256,uint256,bytes32[])[],bytes32,address)",
//   data: "0xe7acab24000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000006600000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000005a00000000000000000000000003e17258a44f938db9803c18c3c762653f5a23e54000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000635cd70400000000000000000000000000000000000000000000000000000000635e287b0000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000187e89252522dbc30000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cc47f20295c00000000000000000000000000000000000000000000000000000cc47f20295c000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000004000000000000000000000000880644ddf208e471c6f2230d31f9027578fa6fcc802a1a1d99ccaaa0e54a5ba59e403789e3a954b26de65e1e5757465404c2edc7000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000040000000000000000000000003e17258a44f938db9803c18c3c762653f5a23e540000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000051b660cdd580000000000000000000000000000000000000000000000000000051b660cdd580000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a36cc19bab000000000000000000000000000000000000000000000000000000a36cc19bab0000000000000000000000000000e5c3b29c53e1d6475b0e995dc12296254f2e8c0e00000000000000000000000000000000000000000000000000000000000000414a4233a0617ade1e6989ad5f582a81fda6ac7a7f085ca36e6ee73e9f9549265b69fe7874e851e2ae6485249e7126540110a9880279214dda4fd0a02ee6e149351c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000108b00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000d848b24adc6576fdc79956d2d95a6a67f64284e3f4be7af89e63e28cf1be11c82fd68b8a8fed02d20f911b1cfdac969a64553b0a730f32d97add20da85d747190eaf998ea100e4303239197a9e36d47b3d6682c2db660da80528cb136e81addd7aedceb3b31ed993b40b44ee6db583fe78bca85d901b38272ca26d749f56641a2b09232daf611b68d6f76cc45c4cbcd304bc51d8018d402fbeb6b4e0d8ea566d305000c26836523c641feae27e449017da055b5e211cd7a4c312f0ab0a369211fee8e9f06b756d274bb0b7ab03bc66a63398c62b707239fb6cd7dc7bd2aec970407ff660b72fb3e42e956a15005b3567f7e51a323e27275de2dce6681eec333e9755081e80eed40bac247c631339db299bf3844398db2ed6745d90b73fad0dc5a9fb37632ae1c4f48cbd5a217f8c7770e66c04392c4dab1faa53b43316e94b8947948896ead29de99602fb9d1cbbbcd837708c14dcc7d49f68168f189388548a275f3afadcb38c51573851c434bf74a925dfead32432c201a9337636c6b9a4246460ba0b8695a79752610bc128c5161b63e0c9f1c7607f4d1dc56d87de8c18869360c6ebe",
// });

// eventDecoder({
//   textSignature:
//     "OrderFulfilled(bytes32,address,address,address,(uint8,address,uint256,uint256)[],(uint8,address,uint256,uint256,address)[])",
//   logs: [
//     "0x9d9af8e38d66c62e2c12f0225249fd9d721c54b83f48d9352c97c6cacdcb6f31",
//     "0x0000000000000000000000003e17258a44f938db9803c18c3c762653f5a23e54",
//     "0x000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c00",
//   ],
//   data: "0x789fdb839c2e708aadf833c6f9e0911b15de023788b6a425bba8c0a8f534d9af00000000000000000000000026043762cbaa719ce3194d659278467e29a9ad2e0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003311fc80a57000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000002000000000000000000000000880644ddf208e471c6f2230d31f9027578fa6fcc000000000000000000000000000000000000000000000000000000000000108b00000000000000000000000000000000000000000000000000000000000000010000000000000000000000003e17258a44f938db9803c18c3c762653f5a23e540000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000146d98337560000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000028db3066eac000000000000000000000000000e5c3b29c53e1d6475b0e995dc12296254f2e8c0e",
// });
